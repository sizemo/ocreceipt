<!doctype html>
<html lang="en" data-theme="midnight">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCReceipt </title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <main id="main-content" class="container" tabindex="-1">
      <section id="auth-section" class="card auth-card">
        <h1>OCReceipt</h1>
        <p>Sign in to access your instance.</p>
        <form id="login-form" class="auth-form" autocomplete="off" novalidate>
          <label>
            Username
            <input id="login-username" type="text" required aria-describedby="auth-error" />
          </label>
          <label>
            Password
            <div class="password-field">
  <input id="login-password" type="password" required aria-describedby="auth-error" />
  <button type="button" class="password-toggle secondary" data-toggle-password data-target="login-password" aria-pressed="false">Show</button>
</div>
          </label>
          <button id="login-btn" type="submit">Sign in</button>
        </form>
        <small id="auth-error" class="err-text" role="alert" aria-live="assertive"></small>
      </section>

      <div id="app-shell" hidden>
        <header class="topbar">
          <div>
            <h1>OCReceipt</h1>
            <p id="session-label">Signed in</p>
          </div>
          <div class="topbar-actions">
            <div class="menu-wrap">
              <button id="menu-toggle" type="button" class="secondary">Menu</button>
              <div id="user-menu" class="menu" hidden>
                <a id="admin-link" href="/admin-panel" class="menu-item" hidden>Admin Panel</a>
                <label class="menu-theme" for="theme-select">Theme
                  <select id="theme-select" class="menu-theme-select">
                    <option value="light">Light</option>
                    <option value="midnight">Midnight Blue</option>
                    <option value="oled">OLED Black</option>
                  </select>
                </label>
                <button id="logout-btn" type="button" class="menu-item danger-text">Logout</button>
              </div>
            </div>
          </div>
        </header>

        <section id="upload-card" class="card uploader admin-only">
          <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-controls="file-input" aria-label="Upload receipt files by drag and drop or by opening the file picker">
            <p><strong>Drag and drop receipt images or PDFs here</strong></p>
            <p>or</p>
            <label class="button" for="file-input">Choose files</label>
            <input id="file-input" type="file" accept="image/*,.pdf,application/pdf" multiple />
            <small>Multiple files supported.</small>
          </div>
          <div class="actions upload-actions">
            <button id="upload-btn" type="button">Upload selected files</button>
          </div>
          <ul id="upload-list" class="upload-list" aria-live="polite" aria-atomic="false"></ul>
          <p id="upload-status" class="sr-only" role="status" aria-live="polite"></p>
        </section>

        <section class="card" aria-labelledby="logged-receipts-heading">
          <div class="table-header">
            <h2 id="logged-receipts-heading">Logged Receipts</h2>
            <div class="table-actions">
              <button id="refresh-btn" type="button" class="secondary">Refresh</button>
              <a id="export-csv-link" class="button secondary" href="/receipts/export">Export CSV</a>
            </div>
          </div>

          <div class="table-filters">
            <label>
              Date From
              <input id="filter-date-from" type="date" />
            </label>
            <label>
              Date To
              <input id="filter-date-to" type="date" />
            </label>
            <label>
              Merchant
              <input id="filter-merchant" type="text" list="merchant-filter-list" placeholder="Any merchant" />
              <datalist id="merchant-filter-list"></datalist>
            </label>
            <label>
              Review Status
              <select id="filter-review">
                <option value="all">All</option>
                <option value="reviewed">Reviewed</option>
                <option value="needs_review">Needs Review</option>
              </select>
            </label>
            <div class="filter-actions">
              <button id="apply-filters-btn" type="button" class="secondary">Apply filters</button>
              <button id="clear-filters-btn" type="button" class="secondary">Clear</button>
            </div>
          </div>
          <p id="filter-help" class="sr-only">Use the filters and press Apply filters to narrow results. Columns with sort buttons can be sorted ascending or descending.</p>

          <p id="sort-status" class="sr-only" role="status" aria-live="polite"></p>
          <div class="table-wrap">
            <table aria-describedby="filter-help receipts-table-caption">
              <caption id="receipts-table-caption" class="sr-only">Logged receipts with sortable columns for ID, date, merchant, total, sales tax, confidence, review status, and created date.</caption>
              <thead>
                <tr>
                  <th scope="col" data-sort-col="id" aria-sort="none"><button type="button" class="th-sort" data-sort="id" aria-label="Sort by ID">ID</button></th>
                  <th scope="col" data-sort-col="purchase_date" aria-sort="none"><button type="button" class="th-sort" data-sort="purchase_date" aria-label="Sort by date">Date</button></th>
                  <th scope="col" data-sort-col="merchant" aria-sort="none"><button type="button" class="th-sort" data-sort="merchant" aria-label="Sort by merchant">Merchant</button></th>
                  <th scope="col" data-sort-col="total_amount" aria-sort="none"><button type="button" class="th-sort" data-sort="total_amount" aria-label="Sort by total amount">Total</button></th>
                  <th scope="col" data-sort-col="sales_tax_amount" aria-sort="none"><button type="button" class="th-sort" data-sort="sales_tax_amount" aria-label="Sort by sales tax">Sales Tax</button></th>
                  <th scope="col" data-sort-col="extraction_confidence" aria-sort="none"><button type="button" class="th-sort" data-sort="extraction_confidence" aria-label="Sort by extraction confidence">Confidence</button></th>
                  <th scope="col" data-sort-col="reviewed" aria-sort="none"><button type="button" class="th-sort" data-sort="reviewed" aria-label="Sort by review status">Review</button></th>
                  <th scope="col" data-sort-col="created_at" aria-sort="descending"><button type="button" class="th-sort" data-sort="created_at" aria-label="Sort by created date">Created</button></th>
                  <th scope="col">Receipt</th>
                  <th scope="col" class="admin-only">Edit</th>
                  <th scope="col" class="admin-only">Delete</th>
                </tr>
              </thead>
              <tbody id="receipts-body"></tbody>
            </table>
          </div>
        </section>
      </div>
    </main>

    <dialog id="receipt-modal" class="receipt-modal" aria-modal="true" aria-labelledby="receipt-modal-title">
      <div class="modal-head">
        <h3 id="receipt-modal-title">Receipt Preview</h3>
        <button id="close-modal-btn" type="button" class="secondary" aria-label="Close receipt preview">Close</button>
      </div>
      <div id="receipt-modal-body" class="receipt-modal-body">
        <img id="receipt-modal-image" alt="Uploaded receipt preview" hidden />
        <div id="receipt-modal-pages" class="receipt-modal-pages" hidden></div>
      </div>
    </dialog>

    <dialog id="edit-modal" class="receipt-modal admin-only" aria-modal="true" aria-labelledby="edit-modal-title">
      <form id="edit-form" class="edit-form" autocomplete="off">
        <div class="modal-head">
          <h3 id="edit-modal-title">Edit Receipt</h3>
          <button id="cancel-edit-btn" type="button" class="secondary" aria-label="Cancel edit receipt">Cancel</button>
        </div>

        <div class="edit-modal-grid">
          <div class="edit-modal-main">

        <input id="edit-id" type="hidden" />

        <label for="edit-date">Date</label>
        <input id="edit-date" type="date" />

        <label for="edit-merchant">Merchant</label>
        <div class="typeahead-wrap">
          <input id="edit-merchant" type="text" maxlength="200" placeholder="Merchant" />
          <div id="merchant-suggestions" class="suggestions" role="listbox" aria-label="Merchant suggestions"></div>
        </div>

        <label for="edit-total">Total Amount</label>
        <input id="edit-total" type="number" step="0.01" min="0" placeholder="0.00" />

        <label for="edit-tax">Sales Tax Amount</label>
        <input id="edit-tax" type="number" step="0.01" min="0" placeholder="0.00" />

        <div class="actions">
          <button id="save-edit-btn" type="submit">Save changes</button>
        </div>

          </div>
          <aside class="edit-modal-aside">
            <img id="edit-modal-image" alt="Receipt preview for editing" hidden />
            <small id="edit-modal-image-hint" class="muted" hidden>Click the image to zoom.</small>
          </aside>
        </div>
      </form>
    </dialog>

    <script src="/static/app.js" defer></script>
  </body>
</html>
