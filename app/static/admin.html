<!doctype html>
<html lang="en" data-theme="midnight">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Receipt OCR Admin</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <main id="main-content" class="container" tabindex="-1">
      <section id="auth-section" class="card auth-card">
        <h1>Admin Access</h1>
        <p>Sign in with an admin account.</p>
        <form id="login-form" class="auth-form" autocomplete="off" novalidate>
          <label>
            Username
            <input id="login-username" type="text" required aria-describedby="auth-error" />
          </label>
          <label>
            Password
            <div class="password-field">
  <input id="login-password" type="password" required aria-describedby="auth-error" />
  <button type="button" class="password-toggle secondary" data-toggle-password data-target="login-password" aria-pressed="false">Show</button>
</div>
          </label>
          <button type="submit">Sign in</button>
        </form>
        <small id="auth-error" class="err-text" role="alert" aria-live="assertive"></small>
      </section>

      <div id="admin-shell" hidden>
        <header class="topbar">
          <div>
            <h1>Admin Panel</h1>
            <p id="session-label">Signed in</p>
          </div>
          <div class="topbar-actions">
            <div class="menu-wrap">
              <button id="menu-toggle" type="button" class="secondary">Menu</button>
              <div id="user-menu" class="menu" hidden>
                <a href="/" class="menu-item">Receipts</a>
                <label class="menu-theme" for="theme-select">Theme
                  <select id="theme-select" class="menu-theme-select">
                    <option value="light">Light</option>
                    <option value="midnight">Midnight Blue</option>
                    <option value="oled">OLED Black</option>
                  </select>
                </label>
                <button id="logout-btn" type="button" class="menu-item danger-text">Logout</button>
              </div>
            </div>
          </div>
        </header>

        <section class="card">
          <h2>Users</h2>
          <div class="admin-grid">
            <div class="admin-box">
              <h3>Create User</h3>
              <form id="create-user-form" class="admin-form" autocomplete="off" novalidate>
                <label>Username <input id="new-user-username" type="text" required /></label>
                <label>Password <div class="password-field">
  <input id="new-user-password" type="password" required />
  <button type="button" class="password-toggle secondary" data-toggle-password data-target="new-user-password" aria-pressed="false">Show</button>
</div></label>
                <label>
                  Role
                  <select id="new-user-role">
                    <option value="view">View</option>
                    <option value="admin">Admin</option>
                  </select>
                </label>
                <button type="submit">Create user</button>
              </form>
            </div>

            <div class="admin-box">
              <h3>Existing Users</h3>
              <table class="compact-table">
                <caption id="admin-users-caption" class="sr-only">Existing users and available account actions.</caption>
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Username</th>
                    <th scope="col">Role</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody id="admin-users-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        

        <section class="card">
          <h2>API Tokens</h2>
          <p>Create an upload token for Apple Shortcuts or other automation. Tokens are shown only once.</p>

          <div class="admin-grid">
            <div class="admin-box">
              <h3>Create Token</h3>
              <form id="create-token-form" class="admin-form" autocomplete="off" novalidate>
                <label>Name <input id="new-token-name" type="text" required /></label>
                <button type="submit">Create token</button>
              </form>
              <div class="token-output">
  <small id="token-created" class="muted" role="status" aria-live="polite"></small>
  <button id="copy-token-btn" type="button" class="secondary" disabled aria-label="Copy newly created token">Copy</button>
</div>
            </div>

            <div class="admin-box">
              <h3>Existing Tokens</h3>
              <table class="compact-table">
                <caption id="api-tokens-caption" class="sr-only">API tokens and revoke actions.</caption>
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Prefix</th>
                    <th scope="col">Scope</th>
                    <th scope="col">Revoked</th>
                    <th scope="col">Last Used</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody id="api-tokens-body"></tbody>
              </table>
            </div>
          </div>
        </section>
<section class="card">
          <h2>Settings</h2>
          <form id="settings-form" class="admin-form">
            <div class="settings-panel">
              <p class="settings-title">Display</p>
              <label>
                Default Currency (ISO 4217)
                <input id="default-currency" type="text" maxlength="3" required />
              </label>
            </div>

            <div class="settings-panel settings-panel-emphasis">
              <p class="settings-title">Visuals</p>
              <label class="toggle-row toggle-setting" for="visual-accessibility-enabled">
                <span>
                  <strong>Visual Accessibility Cues</strong>
                  <small class="muted">Show stronger focus outlines and invalid-field highlights.</small>
                </span>
                <input id="visual-accessibility-enabled" type="checkbox" />
              </label>
              <small class="muted">Uncheck this for a cleaner, lower-highlight UI.</small>
            </div>

            <button type="submit">Save settings</button>
          </form>
        </section>

        <section class="card">
          <h2>Danger Zone</h2>
          <p>Reset the entire instance data (receipts, merchants, users except current admin).</p>
          <button id="reset-instance-btn" type="button" class="danger">Reset instance</button>
        </section>

        <small id="admin-message" role="status" aria-live="polite"></small>
      </div>


      <dialog id="set-password-modal" class="receipt-modal" aria-modal="true" aria-labelledby="set-password-title">
        <div class="modal-head">
          <div>
            <h3 id="set-password-title">Set Password</h3>
            <p class="muted">User <span id="set-password-user"></span></p>
          </div>
          <button id="close-set-password" type="button" class="secondary" aria-label="Close set password dialog">Close</button>
        </div>
        <form id="set-password-form" class="edit-form" autocomplete="off" novalidate>
          <label>
            New Password
            <div class="password-field">
              <input id="set-password-input" type="password" required minlength="12" />
              <button type="button" class="password-toggle secondary" data-toggle-password data-target="set-password-input" aria-pressed="false">Show</button>
            </div>
          </label>
          <button type="submit">Update password</button>
        </form>
        <small class="muted">At least 12 characters.</small>
      </dialog>

    </main>

    <script src="/static/admin.js" defer></script>
  </body>
</html>
